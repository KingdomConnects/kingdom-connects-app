<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Business Profile</title>
  <link rel="stylesheet" href="style.css">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD3Im6F3lWgMbJiA7plsDt_Rp9kCLTr6KU",
      authDomain: "kingdom-commerce.firebaseapp.com",
      projectId: "kingdom-commerce",
      storageBucket: "kingdom-commerce.appspot.com",
      messagingSenderId: "926457853462",
      appId: "1:926457853462:web:eba8e9ecb2bb5ff43da737"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    function getBusinessId() {
      const params = new URLSearchParams(window.location.search);
      return params.get('id') || "HDq5RCjVsUizUz0M0SmQ";  // Fallback Test ID
    }

    async function loadBusiness() {
      const businessId = getBusinessId();
      const businessDiv = document.getElementById("businessDetails");
      const reviewLink = document.getElementById("reviewLink");

      if (!businessId) {
        businessDiv.innerHTML = "<p>No business ID found in URL.</p>";
        return;
      }

      try {
        const docRef = doc(db, "business_listings", businessId);
        const docSnap = await getDoc(docRef);

        if (docSnap.exists()) {
          const b = docSnap.data();

          businessDiv.innerHTML = `
            <h1>${b.business_name || "Unnamed Business"}</h1>
            <p><strong>City:</strong> ${b.city || ""}</p>
            <p><strong>Church:</strong> ${b.church_name || ""}</p>
            <p><strong>Category:</strong> ${b.category || ""}</p>
            ${b.subcategory ? `<p><strong>Subcategory:</strong> ${b.subcategory}</p>` : ""}
            ${b.website_url ? `<p><strong>Website:</strong> <a href="${b.website_url}" target="_blank">${b.website_url}</a></p>` : ""}
          `;

          // Set the review link URL with correct business ID
          reviewLink.href = `submit_review.html?id=${businessId}`;

        } else {
          businessDiv.innerHTML = "<p>Business not found.</p>";
        }

      } catch (error) {
        console.error("Error loading business:", error);
        businessDiv.innerHTML = "<p>Error loading business details.</p>";
      }
    }

    document.addEventListener('DOMContentLoaded', loadBusiness);
  </script>
</head>
<body>

  <img src="library/kingdom-commerce-logo.png" alt="Kingdom Commerce Logo" class="logo">

  <a class="nav-btn" href="home.html">‚Üê Back to Home</a>

  <div id="businessDetails">
    <p>Loading business details...</p>
  </div>

  <a id="reviewLink" class="nav-btn" href="#">Leave a Review</a>

</body>
</html>