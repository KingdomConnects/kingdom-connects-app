<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Submit Your Business</title>
  <link rel="stylesheet" href="styles/style.css" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      doc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_AUTH_DOMAIN",
  projectId: "kingdom-commerce",
  storageBucket: "YOUR_STORAGE_BUCKET",
  messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
  appId: "YOUR_APP_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const churchSelect = document.getElementById("church_select");
const form = document.getElementById("businessForm");
const statusDiv = document.getElementById("statusMessage");

async function loadChurches() {
  try {
    const snapshot = await getDocs(collection(db, "churches"));
    snapshot.forEach((docSnap) => {
      const data = docSnap.data();
      const option = document.createElement("option");
      option.value = docSnap.id;
      option.textContent = data.name || "Unnamed Church";
      churchSelect.appendChild(option);
    });
    console.log("Church list loaded.");
  } catch (error) {
    console.error("Error loading churches:", error);
    statusDiv.textContent = "⚠️ Failed to load church list.";
  }
}

form.addEventListener("submit", async (e) => {
  e.preventDefault();
  statusDiv.textContent = "Submitting...";

  const businessData = {
    business_name: document.getElementById("business_name").value,
    contact_name: document.getElementById("contact_name").value,
    contact_email: document.getElementById("contact_email").value,
    description: document.getElementById("description").value,
    phone: document.getElementById("phone").value,
    website: document.getElementById("website").value,
    address_line1: document.getElementById("address_line1").value,
    address_line2: document.getElementById("address_line2").value,
    city: document.getElementById("city").value,
    state: document.getElementById("state").value,
    zip_code: document.getElementById("zip_code").value,
    churchId: churchSelect.value,
    created_at: new Date()
  };

  console.log("Submitting business data:", businessData);

  try {
    const churchRef = doc(db, "churches", businessData.churchId);
    const churchSnap = await getDoc(churchRef);
    if (!churchSnap.exists()) {
      throw new Error("Selected church does not exist in database.");
    }

    await addDoc(collection(db, "business_listings"), businessData);
    statusDiv.textContent = "Business submitted successfully.";
    statusDiv.className = "success";
    form.reset();
  } catch (error) {
    console.error("Submission error:", error);
    statusDiv.textContent = "Error: " + error.message;
    statusDiv.className = "error";
  }
});

loadChurches();

  </script>
</head>
<body>
  <div class="form-container">
    <h1>Submit Your Business</h1>
    <form id="businessForm">
      <label>Business Name</label>
      <input type="text" id="business_name" required /><label>Your Name</label>
  <input type="text" id="contact_name" required />

  <label>Contact Email</label>
  <input type="email" id="contact_email" required />

  <label>Brief Description</label>
  <textarea id="description" required></textarea>

  <label>Phone Number</label>
  <input type="tel" id="phone" required />

  <label>Website URL</label>
  <input type="url" id="website" />

  <label>Address Line 1</label>
  <input type="text" id="address_line1" required />

  <label>Address Line 2</label>
  <input type="text" id="address_line2" />

  <label>City</label>
  <input type="text" id="city" required />

  <label>State</label>
  <input type="text" id="state" required />

  <label>ZIP Code</label>
  <input type="text" id="zip_code" required />

  <label>Select Your Church</label>
  <select id="church_select" required>
    <option value="">-- Select --</option>
  </select>

  <button type="submit">Submit</button>
</form>
<div id="statusMessage"></div>

  </div>
</body>
</html>